"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[45265],{94956:function(e,t,r){r.d(t,{Bj:function(){return l},HZ:function(){return i},J6:function(){return c},X1:function(){return o},eH:function(){return s}});var a=r(25628),n=r(25949);function s(){return(0,a.IG)(null,(()=>{const e=d();return{flags:{...e.flags},basicContext:{...e.basicContext}}}))}async function o(){return(0,a.IG)(Promise.resolve(!1),(async()=>{const e=(0,n.f)();return d()?e.resolve(!0):function t(){d()?e.resolve(!0):setTimeout(t,100)}(),e.promise}))}function i(e){const t=(0,a.IG)(null,(()=>d()));return t?t.on("update",e):null}function l(){const e=(0,a.IG)(null,(()=>d()));return e?{addOverrides:e.addLocalOverrides.bind(e),resetOverrides:e.resetLocalOverrides.bind(e)}:null}async function c(){return await(0,a.IG)(Promise.resolve(!1),(async()=>!!navigator?.serviceWorker?.getRegistrations&&(await navigator.serviceWorker.getRegistrations()).some((e=>e?.active?.scriptURL.includes(`${window.location.hostname}/service-worker-pwa.js`)))))}function d(){return(0,a.IG)(null,(()=>window.__HELIOS_FLAGR__))}},78364:function(e,t,r){r.d(t,{f:function(){return qe}});var a=r(30091),n=r(98116),s=r(47047),o=r(63246),i=r(15863),l=r(25628),c=r(78260);const d=(0,c.cr)("platform",{name:"feature_flags_v2"});var u=r(18446),f=r.n(u),v=r(76830),g=(r(21703),r(94956)),m=r(77606),p=r.n(m);function h(e){let{variantKey:t}=e;return"on"===t&&(t=!0),"off"===t&&(t=!1),p()(e.variantAttachment)?t:e.variantAttachment}function y(e){const t={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e[r]?t[r]=h({...e[r],flagKey:r}):t[r]=e[r]);return t}const w=new Set,k=new Map,b={mapValue:e=>e,defaultValue:void 0},E=(0,n.createStore)(!1,{sid:"abqrc3"}),O=(0,n.createEvent)({sid:"tbl3eq"}),$=(0,n.createEvent)({sid:"45iqb8"}),_=(0,n.createEffect)(g.X1,{sid:"-6tzy3w"}),j=(0,n.createEvent)({sid:"nvgari"}),F=(0,n.createEffect)((()=>{const e=(0,n.scopeBind)(j);(0,g.HZ)(e)}),{sid:"-88huao"});(0,n.sample)({and:[{clock:O,target:_}],or:{sid:"-711la2"}}),(0,n.sample)({and:[{clock:_.doneData,filter:Boolean,target:[E,F,$]}],or:{sid:"-6mqxuo"}});const S=(0,n.createEffect)(g.eH,{sid:"-22v21c"}),x=(0,n.createEffect)(g.J6,{sid:"urqa1j"});function V(e){const t={};return Object.entries(e).forEach((([e,r])=>{let a=h({flagKey:e,variantKey:r.evaluationResult?.variantKey,variantAttachment:r.evaluationResult?.variantAttachment});const n=r.defaultValue===r.evaluationResult?.variantKey?void 0:r.defaultValue;if(a=a??n,void 0===a)return;const s=k.get(e)?.mapValue??(e=>e),o=k.get(e)?.contract;let i;i=o?.guard(a)?s(a):a,t[e]=i})),t}const A=(0,n.createEffect)((e=>{const t=(0,g.Bj)();if(!t)throw Error("Helios flagr is not ready");t.addOverrides(e)}),{sid:"h8nzh3"}),L=(0,n.createEffect)((e=>{const t=(0,g.Bj)();if(!t)throw Error("Helios flagr is not ready");t.resetOverrides(e)}),{sid:"dpfk98"});function K(e){const t={};return w.forEach((r=>{const a=k.get(r)?.defaultValue??b.defaultValue,n=k.get(r)?.mapValue??b.mapValue;e[r]?t[r]=n(e[r]):t[r]=a})),t}function D(e){const{selene:t,helios:r}=e;return!Object.entries(t).every((([e,t])=>e in r&&f()(t,r[e])))}const{$isClient:q}=o.y.outputs,{$enabled:C,turnOn:B,turnOff:R}=(0,n.withFactory)({sid:"ygf129",fn:()=>(0,s.d)(i.qs,!1)});(0,n.sample)({and:[{clock:B,filter:q,target:O}],or:{sid:"7ierqk"}});const H=(0,n.createStore)((0,l.IG)({auid:null},(()=>window.__FLAGS_CTX__??{auid:null})),{sid:"-iic3ht"}),z=(0,n.createStore)(null,{and:{sid:"$heliosFlags"},sid:"-gmjm0d"}),G=(0,n.createStore)({},{and:{sid:"$flags"},sid:"-r3e98o"});(0,n.sample)({and:[{clock:B,source:z,filter:e=>Boolean(e),fn:e=>y(e),target:G}],or:{sid:"8i5eb1"}});const M=function(e){const t=(0,n.createEvent)({sid:"xyicbo"}),r=(0,n.attach)({and:{source:{flags:e.flags,ctx:e.context},effect:e=>e},or:{sid:"2iazah"}});let a=0;const s=(0,n.createEffect)((async()=>{a+=1;const e=a,t=await x(),[n,s]=await Promise.all([S(),r()]),o=s.flags;if(!n)return null;const i=function(e){const{seleneFlags:t,heliosFlags:r}=e;let a=!1;const n={};return Object.entries(t).forEach((([e,t])=>{const s=r[e];if(s&&!f()(t,s)){if("on"===s||"off"===s){if(t?.enabled===("on"===s))return;if(t===("on"===s))return}a=!0,n[e]={helios:s,selene:t}}})),a?n:null}({heliosFlags:V(n.flags),seleneFlags:K(o)});if(i){const r={mismatch:i,swEnabled:t,checkCount:e,ctx:{ctxMismatch:D({selene:s.ctx,helios:n.basicContext}),helios:n.basicContext,selene:s.ctx}};return console.log("Flags mismatch!",r),{flags:i?r:null}}return null}),{sid:"-pvguf"}),i=o.y.outputs.$isClient.map((e=>e?3e3:0));return(0,n.sample)({and:[{clock:(0,n.withFactory)({sid:"epyph6",fn:()=>(0,v.D)({source:(0,n.sample)({and:[{clock:[j,e.flags,e.start],filter:o.y.outputs.$isClient}],or:{sid:"-uljng7"}}),timeout:i,name:"debounce: platform flags check"})}),target:s}],or:{sid:"-wm816p"}}),(0,n.sample)({and:[{clock:s.failData,target:d.sendErrorLog}],or:{sid:"-vo4seb"}}),s.failData.watch(console.error),(0,n.sample)({and:[{clock:s.doneData.map((e=>e?.flags??null)),filter:Boolean,target:t}],or:{sid:"-v6jder"}}),{flagsMismatched:t}}({start:B,flags:G,context:H});(0,n.sample)({and:[{clock:M.flagsMismatched,fn:e=>({msg:"Feature flags are mismatched between Selene and Helios",error:e}),target:d.sendErrorLog}],or:{sid:"91e72o"}}),r(26699);var I=r(72675),P=r(35529),U=r(94547),N=r(20611);const J=(0,n.createEvent)({sid:"cuh18e"}),X=(0,n.createEvent)({sid:"-ivfh41"}),T=(0,n.createEvent)({sid:"xn1t9a"}),W=(0,n.createStore)({},{sid:"cc25m2"}).on(J,((e,t)=>({...e,...t}))).on(X,((e,t)=>{const r={...e};for(const e of t)delete r[e];return r})).on(T,(()=>({}))),Y="ffv2_overrides",{$href:Z,$origin:Q}=N.D.outputs,{createQueryParameterApi:ee}=N.D.inputs,{$isClient:te}=o.y.outputs,re=ee({name:Y,clientOnly:!0});(0,n.sample)({and:[{clock:(0,n.sample)({and:[{clock:B,filter:te}],or:{sid:"droyrc"}}),source:re.$value,filter:Boolean,fn:e=>JSON.parse(e),target:W}],or:{sid:"-frcq0e"}});const ae=(0,n.createEvent)({sid:"-yfjg3e"}),ne=(0,n.createStore)(null,{sid:"2ah4zi"});(0,n.sample)({and:[{clock:ae,source:{overrides:W,href:Z,origin:Q},fn:({overrides:e,href:t,origin:r})=>{const a=new URL(`${r}${t}`);return a.searchParams.set(Y,JSON.stringify(e)),a.toString()},target:ne}],or:{sid:"-f9rb0u"}});const se=(0,U.Yu)("ffv2_overrides",{adapter:U.j$.json({contract:P.Unknown})}),oe=(0,n.createEffect)((()=>se.read()),{sid:"n7k3ad"}),ie=(0,n.createEffect)((e=>se.write(e)),{sid:"-dftd35"});(0,n.sample)({and:[{clock:W,target:ie}],or:{sid:"-9oinxc"}}),(0,n.sample)({and:[{clock:B,target:oe}],or:{sid:"-9lroyj"}}),(0,n.sample)({and:[{clock:oe.doneData,filter:Boolean,target:W}],or:{sid:"-97h1j5"}});const{$enabled:le,toggle:ce,turnOff:de,turnOn:ue}=(0,n.withFactory)({sid:"-onw1zu",fn:()=>(0,s.d)(i.qs,!0)}),fe=(0,n.sample)({and:[{clock:le,filter:e=>!e}],or:{sid:"9p2ssw"}}),ve=(0,n.sample)({and:[{clock:[W,le],filter:le}],or:{sid:"b8dwho"}});(0,n.sample)({and:[{clock:ve,source:W,fn:e=>{const t={};return Object.entries(e).forEach((([e,r])=>{if(r){const{variantKey:a,variantAttachment:n}=r;t[e]={variantKey:we(a),variantAttachment:n}}})),t},target:A}],or:{sid:"-7r8l5u"}}),(0,n.sample)({and:[{clock:X,target:L}],or:{sid:"-6t5cdg"}}),(0,n.sample)({and:[{clock:[T,fe],fn:()=>{},target:L}],or:{sid:"-6euoy2"}});const ge=(0,n.combine)({and:[[W,le],([e,t])=>{const r={};if(!t)return r;for(const[t,a]of Object.entries(e))if(a){const{variantKey:e,variantAttachment:n}=a;r[t]={variantKey:we(e),variantAttachment:n}}else r[t]=null;return r}],or:{sid:"-nveq0p"}}),me=(0,n.combine)({and:[{flags:G,overrides:ge},({flags:e,overrides:t})=>({...e,...y(t)})],or:{sid:"hdtwsu"}}),pe=(0,n.combine)({and:[{heliosFlags:z,overrides:ge},({heliosFlags:e,overrides:t})=>({...e,...t})],or:{sid:"-8omj9y"}}),he=W.map((e=>Object.keys(e).length>0)),ye=(0,n.withFactory)({sid:"o2s65x",fn:()=>(0,I.x)(he,le)});function we(e){return e.includes(" (")?e.split(" (")[0]:e}const ke=pe.map((e=>e?Object.entries(e).filter((([e])=>/^.*-exp-.*/.test(e))).reduce(((e,[t,r])=>({...e,[t]:r.variantKey})),{}):{}));var be=r(51717),Ee=r(39550),Oe=r(82249);const $e=Symbol("NoOverride"),_e=(0,P.Record)({flagKey:P.String,variantKey:P.String.optional(),variantAttachment:P.Unknown.optional()}),je=((0,P.Record)({evaluationResults:(0,P.Array)(_e)}),(0,n.createStore)([],{and:{serialize:"ignore"},sid:"fwsqj5"})),Fe=(0,n.createEvent)({sid:"-etkfuh"});je.on(Fe,((e,t)=>[...e,t]));const{appInited:Se,$isServer:xe,$isClient:Ve}=o.y.outputs;function Ae({name:e,contract:t,mapValue:r=Ke,defaultValue:a}){w.has(e)&&Oe.O.isProduction&&c.kg.error({error:Error(`Flag [${e}] already declared`)}),w.add(e),k.set(e,{defaultValue:a,mapValue:r,contract:t});const s=(0,n.createEvent)({sid:"b4oi68"}),o=me.map((t=>e in t)),i=(0,n.createStore)($e,{and:{serialize:"ignore"},sid:"-b376uu"}),l=me.map((t=>t[e]??null)),u=l.map((e=>!t.guard(e))),f=(0,n.combine)({and:[{flag:l,override:i,orVal:(v=a,n.is.store(v,{sid:"ijiihb"})?v:(0,n.createStore)(v,{and:{serialize:"ignore"},sid:"3c82n1"}))},({flag:e,override:a,orVal:n})=>a!==$e?a:t.guard(e)?r(e):n],or:{sid:"at9v0j"}});var v;const{$errorMessage:g,$invalidValue:m}=(0,n.withFactory)({sid:"-16itz7",fn:()=>(0,be.X)({source:l.map((e=>{const r=t.validate(e);return r.success?null:{result:r,value:e}})),shape:{$errorMessage:e=>e?.result?.message??null,$invalidValue:e=>e?.value??null}})}),p=(0,n.combine)({and:[{invalidValue:m,value:f,errorMessage:g}],or:{sid:"-lcv70p"}});return(0,n.sample)({and:[{clock:Se,source:p,filter:(0,n.withFactory)({sid:"-nvyr36",fn:()=>(0,I.x)(u,xe,o)}),fn:({invalidValue:t,value:r,errorMessage:a})=>({name:e,recievedValue:t,fallbackValue:r,message:a}),target:Fe}],or:{sid:"-1m0v6"}}),(0,n.sample)({and:[{clock:[s,f],source:p,filter:(0,n.withFactory)({sid:"2mk2zq",fn:()=>(0,I.x)(u,Ve,o)}),fn:t=>({error:Error(`[feature flags fail] Flag [${e}] contract failed]`),extra:t}),target:d.sendErrorLog}],or:{sid:"t6gd2"}}),"undefined"!=typeof window&&(0,n.scopeBind)(s,{scope:(0,Ee.M)(),safe:!0})(),{name:e,$value:f,$stale:u,defaultValue:a,__:{$override:i}}}const Le=(0,n.withFactory)({sid:"yd4sob",fn:()=>(0,s.s)(Ae)});function Ke(e){return e}const De={internals:{$flags:G,$heliosFlags:z,$context:H,convertHeliosFlagsToSeleneFlags:y,knownFlags:w,addOverrides:J,resetAllOverrides:T,resetOverrides:X,$overrides:W,$hasOverrides:he,$hasActiveOverrides:ye,$overridesEnabled:le,allowOverrides:ue,blockOverrides:de,toggleOverrides:ce,overridesShareRequested:ae,$overridesShareLink:ne},outputs:{$serverErrors:je,$heliosExpGroups:ke},inputs:{createFlag:Le}},qe=(0,a.Yn)({importMetaUrl:"file:///home/jenkins/agent/workspace/selene/client/src/platform/services/feature_flags_v2/index.ts",api:De,lifecycle:{start:B,stop:R}})}}]);
//# sourceMappingURL=https://private-static.prod.k8s.int.avs.io/selene-source-maps/platform-7f4cbccf21e9b894969b680ec64a5397eed8bc29.43904ff962b85b191f23.min.js.map