"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[23831],{96864:function(e,r,a){a.d(r,{d:function(){return V},W:function(){return vt}});var t={};a.r(t),a.d(t,{availablePaymentMethodsFlag:function(){return ee},foreignCardsSettingFlag:function(){return W}});var s=a(30091),n=a(98116),i=a(83781);let o;!function(e){e.UserSettingsChanged="service/helios/user/user_settings_changed",e.UserSettingsShouldChange="service/helios/user/user_settings_should_change",e.UserNameShouldChange="service/helios/user/user_name_should_change",e.SettingsChanged="service/helios/user/settings_changed",e.SettingsShouldChange="service/helios/user/settings_should_change",e.UserInfoChanged="service/helios/user/user_info_changed",e.UserSocialsChanged="service/helios/user/user_socials_changed",e.GuestiaIdChanged="service/helios/user/guestia_id_changed",e.SearchesChanged="service/helios/user/searches_changed",e.EmailActivationErrorChanged="service/helios/user/email_activation_error_changed",e.ActivateEmail="service/helios/user/activate_email",e.SearchesShouldBeFetched="service/helios/user/searches_should_be_fetched",e.SearchShouldBeSaved="service/helios/user/search_should_be_saved",e.UserShouldBeDeleted="service/helios/user/user_should_be_deleted",e.UserDeleteStatusChanged="service/helios/user/user_delete_status_changed",e.UserDataShouldBeFetched="service/helios/user/user_data_should_be_fetched",e.FetchUserDataFxStatusChanged="service/helios/user/fetch_user_data_fx_status_changed",e.ChangePassengersFxStatusChanged="service/helios/user/change_passengers_fx_status_changed",e.ChangePassengers="service/helios/user/change_passengers"}(o||(o={}));var c=a(41832);a(21703);const d=(0,n.createDomain)({sid:"-nq173g"});var l=a(88046),u=a(2503),g=a(53788),h=a(63246),m=a(57640),p=a(79403),f=a(75381),_=a(20611),v=a(94547),S=a(2905),E=a(25628),k=a(27897),x=a(29125);const y={know_english:{domain:(0,v.Hz)(),expires:1/0},pageview_promos:{domain:(0,v.Hz)(),expires:1/0},pageview_partners:{domain:(0,v.Hz)(),expires:1/0},user_marker:{domain:(0,v.Hz)(),expires:1/0},passengers:{storageProvider:"none"},contact_info:{storageProvider:"none"},prevent_geoip:{domain:(0,v.Hz)(),expires:1/0},searchHistory:{storageProvider:"localStorage"},geoip:{storageProvider:"localStorage",saveOnUserReset:!0}};function U({market:e,brand:r}){const a={origin:{storageProvider:"localStorage",defaultValue:""}},t={...a,use_price_per_passenger:{storageProvider:"localStorage",defaultValue:!1},use_price_per_night:{storageProvider:"localStorage",defaultValue:!1},market:{storageProvider:"localStorage",defaultValue:e.toUpperCase()},citizenship:{storageProvider:"localStorage",defaultValue:e.toUpperCase()},currency:{domain:(0,v.Hz)(),expires:1/0,defaultValue:(0,E.IG)("RUB",(()=>document.documentElement.getAttribute("data-currency")))},...(0,x.L5)(e,{ru:{payment_options:{defaultValue:void 0,storageProvider:"localStorage"}},__:{}})},s={...a,use_price_per_passenger:{storageProvider:"localStorage",defaultValue:!0},use_price_per_night:{storageProvider:"localStorage",defaultValue:!0}};return p.U.inputs.forBrand(r,{[S.qb]:t,[S.R2]:s})}function F(e){return p.U.inputs.forBrand(e,{[S.qb]:k.US.decode("YXZpYXNhbGVz"),[S.R2]:k.US.decode("d2F5YXdheQ==")})}const w=(0,n.createEvent)({sid:"-iraufv"}),P=(0,n.attach)({and:{source:{brand:p.U.outputs.$brand,hostname:_.D.outputs.$hostname,auid:u.Y.outputs.$auid,market:g.D.outputs.$market,isClient:h.y.outputs.$isClient},effect:({brand:e,auid:r,market:a,isClient:t,hostname:s})=>{if(t&&r){const t=(0,f.G1)(m.H.GUESTIA_HOST,{brand:e,currentHost:s});return new l.Z({host:t,authHost:t,uid:r,schema:y,market:a.toUpperCase(),userSettingsSchema:U({brand:e,market:a}),cookieDomain:(0,v.Hz)(),jwtAuthSource:F(e)})}return null}},or:{sid:"u0vley"}}),$=(0,n.createStore)(null,{and:{serialize:"ignore"},sid:"-d970ns"}).on(P.doneData,((e,r)=>r)),C=(0,n.createEvent)({sid:"-p5s6ht"});(0,n.sample)({and:[{clock:$,filter:Boolean,target:C}],or:{sid:"sfv4dq"}});const b=(e,r)=>{const a=(0,n.createEffect)((a=>{a.on(e,(0,n.scopeBind)(r))}),{sid:"wsil94"});a.fail.watch(console.error),(0,n.sample)({and:[{clock:C,target:a}],or:{sid:"-5ldpvd"}})};(0,n.sample)({and:[{clock:w,target:P}],or:{sid:"-55zhaz"}});const D=(0,n.attach)({and:{source:$,effect:(e,r)=>{if(!e)throw new Error("Guestia updateUserSettings method called before initialization");return e.setUserSettings(r)}},or:{sid:"qn0915"}}),z=d.createEvent({sid:"kk6hm"}),A=d.createEvent({sid:"-unm4zl"}),L=(0,n.createStore)({},{sid:"-q9dmi2"}).on(z,((e,r)=>r)).reset(A);b("user_settings_changed",z),b("user_settings_reseted",A);const j=L.map((({currency:e})=>e?.toLocaleLowerCase()??null)),G=(0,n.attach)({and:{mapParams:e=>({currency:e.toUpperCase()}),effect:D},or:{sid:"-rk0scy"}});(0,n.sample)({and:[{clock:j,target:c.y.internals.fillUserCurrency}],or:{sid:"b58yc0"}}),(0,n.sample)({and:[{clock:c.y.internals.changeUserCurrency,target:G}],or:{sid:"bk3ecr"}}),(0,n.sample)({and:[{clock:G.doneData,target:c.y.internals.userCurrencyUpdated}],or:{sid:"bmudbk"}});var I=a(78260);const q=(0,I.cr)("usercom",{name:"user_model_settings"});["citizenship","currency","market","name","notification_channels","notification_language","origin","priority_support_channel","use_price_per_night","use_price_per_passenger","payment_options"].forEach((function(e){(0,n.sample)({and:[{clock:D.fail,filter:({params:r})=>void 0!==r[e],fn:({params:r,error:a})=>({error:a,extra:{params:r,message:a.message},msg:`[user service — user settings] error during update ${e} setting`}),target:q.sendErrorLog}],or:{sid:"-91e0dk"}})}));const B=(0,n.attach)({and:{mapParams:e=>({name:e}),effect:D},or:{sid:"3i46o3"}}),O=L.map((({name:e})=>e??null));let V;!function(e){e.email="email",e.push="push",e.all="all",e.none="none"}(V||(V={}));const Z=(0,n.attach)({and:{mapParams:e=>({notification_channels:e}),effect:D},or:{sid:"-41bks9"}}),N=L.map((({notification_channels:e})=>e||null)),R=N.map((e=>{const r={push:e?.price_alert.mob_push||e?.price_alert.web_push||!1,email:e?.price_alert.email||!1},a=Object.values(r).every(Boolean),{push:t,email:s}=r;return a?V.all:t?V.push:s?V.email:V.none})),H=(0,n.attach)({and:{mapParams:e=>({use_price_per_passenger:e}),effect:D},or:{sid:"-9jqq26"}});a(26699);var M=a(47047),T=a(78364);const J={enabled:!1,informerSuspensionSearchCount:0,informerSuspensionTime:0,informerText:{en:"",ru:""},directions:[],placements:[]};var Y=a(35529);const K=(0,Y.Tuple)(Y.String,Y.String),X=(0,Y.Record)({enabled:Y.Boolean,informerSuspensionSearchCount:Y.Number,informerSuspensionTime:Y.Number,informerText:(0,Y.Record)({en:Y.String,ru:Y.String}),directions:(0,Y.Array)(K),placements:(0,Y.Array)(Y.String)}),Q=(0,Y.Record)({methods:(0,Y.Array)((0,Y.Union)((0,Y.Literal)("ru_card"),(0,Y.Literal)("ww_card"),(0,Y.Literal)("ru_card|ww_card")))}),W=(0,n.withFactory)({sid:"-6idyed",fn:()=>(0,M.d)((()=>T.f.inputs.createFlag({name:"avs-exp-foreignCards",contract:X,defaultValue:J})))}),ee=(0,n.withFactory)({sid:"njcsby",fn:()=>(0,M.d)((()=>T.f.inputs.createFlag({name:"usc-feat-availablePaymentMethods",contract:Q,defaultValue:{methods:[]}})))}),re=["ru_card","ww_card"],ae=ee.$value.map((({methods:e})=>e)),te=ae.map((e=>e.includes("ww_card"))),se=(0,n.combine)({and:[L,te,({payment_options:e},r)=>Array.isArray(e)?function(e,r){return!r&&function(e){return 1===e.length&&"ww_card"===e[0]}(e)?["ru_card","ww_card"]:re.reduce(((r,a)=>(e.includes(a)&&r.push(a),r)),[])}(e,r):null],or:{sid:"-4pq1xr"}}),ne=se.map((e=>Array.isArray(e)?e.join("|"):null)),ie=(0,n.attach)({and:{mapParams:e=>({payment_options:e.split("|")}),effect:D},or:{sid:"-4ozk1u"}}),oe=L.map((({use_price_per_night:e})=>Boolean(e))),ce=(0,n.attach)({and:{mapParams:e=>({use_price_per_night:e}),effect:D},or:{sid:"8prqo7"}}),de=L.map((({autosave_documents:e})=>Boolean(e))),le=(0,n.attach)({and:{mapParams:e=>({autosave_documents:e}),effect:D},or:{sid:"-hcuwbi"}}),ue={changeUserNameFx:B,updateUserSettingsFx:D,changePricePerNightFx:ce,changePricePerPassengerFx:H,changeUserPaymentOptionsFx:ie,changeNotificationChannelsFx:Z,changeUserAutosaveDocumentsFx:le},ge={$userName:O,$userSettings:L,$userPaymentMethod:ne,$userPaymentOptions:se,$notificationChannels:N,$notificationChannelType:R,$isPricePerNightEnabled:oe,$availablePaymentMethods:ae,$userAutosaveDocuments:de};var he=a(46488),me=a.n(he);const pe=d.createEvent({sid:"-va5ltl"}),fe=d.createEvent({sid:"yw351n"}),_e=(0,n.attach)({and:{source:$,effect:(e,r)=>{if(!e)throw new Error("Guestia method called before initialization");return e.setSettings(r.key,r.value)}},or:{sid:"f6hy02"}}),ve=d.createEffect((e=>e.getAllSettings()),{sid:"fom75k"}),Se=d.createStore({},{sid:"8bh7g5"}).on(ve.doneData,((e,r)=>r??{})).on(pe,((e,{key:r,value:a})=>({...e,[r]:a}))).reset(fe);(0,n.sample)({and:[{clock:C,target:ve}],or:{sid:"91nsl1"}}),b("settings_changed",pe),b("settings_reseted",fe);const Ee={changeExternalSettingFx:_e},ke={$settings:Se},xe={createChangeSettingEffect:function({key:e,mapper:r=me()}){return(0,n.attach)({and:{effect:_e,mapParams:a=>({key:e,value:r(a)})},or:{sid:"bbl57l"}})},extractSettingStore:function({key:e,mapper:r=me(),initial:a}){return Se.map((r=>r[e]??null)).map((e=>{if(null===e)return a;const t=r(e);return null===t?a:t}))},settingsChangedByExternalForce:pe};var ye=a(27636),Ue=a(10924),Fe=a(78194);const we=d.createEvent({sid:"-3bgl54"}),Pe=(0,v.Yu)("guestia_id",{adapter:v.j$.json({contract:(0,Y.Record)({id:Y.String.nullable()})})}),$e=d.createEffect(Pe.read,{sid:"-a724ls"}),Ce=d.createEffect(Pe.write,{sid:"-c9o6vv"}),be=(0,n.restore)(we,null,{sid:"tritud"}),De=be.map((e=>e?.last_login_method?e.last_login_method:null)),ze=(0,n.combine)({and:[De,g.D.outputs.$isRuMarket,Fe.J.outputs.$t,function(e,r,a){return e?a("facebook"===e&&r?`service_user:censored_socials.${e}`:`service_user:socials.${e}`):""}],or:{sid:"cl423u"}}),[Ae,Le]=(0,n.withFactory)({sid:"-w068",fn:()=>(0,ye.K)(be.map(Boolean))}),je=d.createStore(null,{sid:"-7gjm7p"}).on($e.doneData,((e,r)=>r?.id??null)).on(be.updates,((e,r)=>r?.id??null));(0,n.sample)({and:[{clock:be.updates,fn:e=>({id:e?.id??null}),target:Ce}],or:{sid:"-ql8r9s"}}),Ue.I.inputs.commonField({name:"guestiaId",source:je}),b("user_info_changed",we),(0,n.sample)({and:[{clock:w,filter:h.y.outputs.$isClient,target:[$e]}],or:{sid:"-po93o4"}});const Ge={$guestiaId:je,$userInfo:be,$userLastLoginMethod:De,$userLoggedIn:Ae,$userLastLoginMethodLabel:ze},Ie={userInfoChangedByGuestia:we,$userLoggedInOverride:Le};var qe=a(79139);const Be=d.createEvent({sid:"-vv7izn"});d.onCreateStore((e=>{e.reset(Be)}));const Oe=d.createEvent({sid:"hrrrof"}),Ve=(0,n.attach)({and:{source:$,effect:e=>{if(!e)throw new Error("Guestia method called before initialization");return e.fetchSearches()}},or:{sid:"-1lxfw2"}}),Ze=(0,n.attach)({and:{source:$,effect:(e,{searchId:r,searchParams:a,cheapestTicket:t})=>{if(!e)throw new Error("Guestia method called before initialization");return e.saveSearch(r,a,t)}},or:{sid:"-2r9zqx"}}),Ne=d.createStore([],{sid:"-qdl1x3"}).on(Ve.doneData,((e,r)=>r?r.searches:[])).reset(Oe),Re=(0,n.withFactory)({sid:"2hzxto",fn:()=>(0,qe.i)(Ve)});Re.reset(Be),(0,n.sample)({and:[{clock:[Ve.fail],target:Oe}],or:{sid:"-5svhsd"}});const He={fetchSearchesFx:Ve,saveSearchFx:Ze},Me={$searches:Ne,$searchesFetchState:Re},{$userLastLoginMethod:Te}=Ge,Je=d.createEvent({sid:"e1si3f"}),Ye=(0,n.restore)(Je,null,{sid:"-d7ezid"}),Ke=(0,n.combine)({and:[Ye,Te,(e,r)=>e&&r?e[r]?.email??null:null],or:{sid:"52fmbb"}});b("user_socials_changed",Je);const Xe={$userSocials:Ye,$userLastLoginMethodEmail:Ke};var Qe=a(38032),We=a(63832),er=a(82249);const{$userInfo:rr}=Ge,{$userSocials:ar}=Xe,tr=(0,I.cr)("usercom",{name:"user_model_email"}),sr=e=>e&&"null"!==e?e:null,nr=e=>{let r=null;if(403!==e.status)return null;try{const a=JSON.parse(e.responseText);return a.errors?.email?[r]=a.errors.email:r=a.error,r}catch(e){return null}},ir=(0,n.attach)({and:{source:$,mapParams:(e,r)=>({email:e,guestia:r}),effect:d.createEffect((({guestia:e,email:r})=>{if(!e)throw new Error("Guestia method called before initialization");return e.activateEmail(r)}),{sid:"sgexlp"})},or:{sid:"acosa0"}}),or=(0,v.kl)("email"),cr=d.createEffect((()=>or.read()??""),{sid:"-h2101v"}),dr=rr.map((e=>e?.email_info??null)),lr=dr.map((e=>e?.activation_status??null)),ur=(0,n.restore)(ir.failData.map(nr),null,{sid:"vs4maa"}),gr=ur.map((e=>"already in use"===e)),hr=lr.map((e=>e===We.G.Active)),mr=dr.map((e=>sr(e?.active_email))),pr=dr.map((e=>sr(e?.candidate_email))),fr=ar.map((e=>(!er.O.isProduction||e?.google?.email.includes("@aviasales.ru"))??!1)),_r=(0,n.combine)({and:[mr,pr,(e,r)=>e||r],or:{sid:"-7qgflk"}});(0,n.sample)({and:[{source:ir.fail,filter:(0,n.withFactory)({sid:"n4a5ny",fn:()=>(0,Qe.f)(gr)}),fn:({error:e,params:r})=>({msg:"[user service] error during email activation",error:e,extra:{params:r,status:e.status,message:nr(e),responseText:e.responseText}}),target:tr.sendErrorLog}],or:{sid:"djzic3"}});const vr={activateEmailFx:ir,getEmailFromCookieFx:cr},Sr={$activeEmail:mr,$candidateEmail:pr,$email:_r,$emailActivationStatus:lr,$emailActivationError:ur,$isPrivateAccessAllowed:fr,$isEmailActive:hr,$emailAlreadyInUseError:gr},Er=(0,n.attach)({and:{source:$,effect:e=>{if(!e)throw new Error("Guestia method called before initialization");return e.deleteUser()}},or:{sid:"hc8diy"}}),kr=(0,n.withFactory)({sid:"-jma7gq",fn:()=>(0,qe.i)(Er)}),xr=(0,n.sample)({and:[{clock:kr,filter:e=>"done"===e}],or:{sid:"-6ubcjs"}}),yr={userDeleteFx:Er},Ur={$userDeleteStatus:kr,userDeleted:xr},Fr=(0,n.attach)({and:{source:$,effect:e=>{if(!e)throw new Error("Guestia method called before initialization");return e.fetchUserData()}},or:{sid:"-z4cxts"}}),wr=(0,n.withFactory)({sid:"-hmqmgf",fn:()=>(0,qe.i)(Fr)}),Pr={fetchUserDataFx:Fr},$r={$fetchUserDataFxStatus:wr};var Cr=a(15863);const{createChangeSettingEffect:br,extractSettingStore:Dr}=xe,zr="passengers",Ar=Dr({key:zr,initial:{},mapper:e=>"string"==typeof e?JSON.parse(e):e}),Lr=br({key:zr,mapper:JSON.stringify}),jr=(0,n.withFactory)({sid:"-rn09pd",fn:()=>(0,Cr.d1)(Lr)}),Gr={changePassengersFx:Lr},Ir={$passengers:Ar},qr={$changePassengersFxStatus:jr},Br=(0,i.Sy)((0,i.ZE)(o.UserSettingsChanged)),Or=(0,i.V6)((0,i.ZE)(o.UserSettingsShouldChange)),Vr=(0,i.V6)((0,i.ZE)(o.UserNameShouldChange)),Zr=(0,i.Sy)((0,i.ZE)(o.SettingsChanged)),Nr=(0,i.V6)((0,i.ZE)(o.SettingsShouldChange)),Rr=(0,i.Sy)((0,i.ZE)(o.UserInfoChanged)),Hr=(0,i.Sy)((0,i.ZE)(o.GuestiaIdChanged)),Mr=(0,i.Sy)((0,i.ZE)(o.SearchesChanged)),Tr=(0,i.V6)((0,i.ZE)(o.SearchesShouldBeFetched)),Jr=(0,i.V6)((0,i.ZE)(o.SearchShouldBeSaved)),Yr=(0,i.Sy)((0,i.ZE)(o.UserSocialsChanged)),Kr=(0,i.V6)((0,i.ZE)(o.ActivateEmail)),Xr=(0,i.Sy)((0,i.ZE)(o.EmailActivationErrorChanged)),Qr=(0,i.V6)((0,i.ZE)(o.UserShouldBeDeleted)),Wr=(0,i.Sy)((0,i.ZE)(o.UserDeleteStatusChanged)),ea=(0,i.V6)((0,i.ZE)(o.UserDataShouldBeFetched)),ra=(0,i.Sy)((0,i.ZE)(o.FetchUserDataFxStatusChanged)),aa=(0,i.Sy)((0,i.ZE)(o.ChangePassengersFxStatusChanged)),ta=(0,i.V6)((0,i.ZE)(o.ChangePassengers));(0,n.sample)({and:[{clock:ge.$userSettings,target:Br}],or:{sid:"-kjslow"}}),(0,n.sample)({and:[{clock:Or,target:ue.updateUserSettingsFx}],or:{sid:"-kh1mq3"}}),(0,n.sample)({and:[{clock:Vr,target:ue.changeUserNameFx}],or:{sid:"-k2qzap"}}),(0,n.sample)({and:[{clock:ke.$settings,target:Zr}],or:{sid:"-jywf56"}}),(0,n.sample)({and:[{clock:Nr,target:Ee.changeExternalSettingFx}],or:{sid:"-jklrps"}}),(0,n.sample)({and:[{clock:Ge.$userInfo,target:Rr}],or:{sid:"-jgr7k9"}}),(0,n.sample)({and:[{clock:Ge.$guestiaId,target:Hr}],or:{sid:"-j2gk4v"}}),(0,n.sample)({and:[{clock:Me.$searches,target:Mr}],or:{sid:"-in2bir"}}),(0,n.sample)({and:[{clock:Tr,target:He.fetchSearchesFx}],or:{sid:"-ikbcjy"}}),(0,n.sample)({and:[{clock:Jr,target:He.saveSearchFx}],or:{sid:"-882muh"}}),(0,n.sample)({and:[{clock:Xe.$userSocials,target:Yr}],or:{sid:"-8482oy"}}),(0,n.sample)({and:[{clock:Sr.$emailActivationError,target:Xr}],or:{sid:"-7otu2u"}}),(0,n.sample)({and:[{clock:Kr,target:vr.activateEmailFx}],or:{sid:"-7aj6ng"}}),(0,n.sample)({and:[{clock:Qr,target:yr.userDeleteFx}],or:{sid:"-76omhx"}}),(0,n.sample)({and:[{clock:Ur.$userDeleteStatus,target:Wr}],or:{sid:"-6sdz2j"}}),(0,n.sample)({and:[{clock:ea,target:Pr.fetchUserDataFx}],or:{sid:"-6ojex0"}}),(0,n.sample)({and:[{clock:$r.$fetchUserDataFxStatus,target:ra}],or:{sid:"-6a8rhm"}}),(0,n.sample)({and:[{clock:qr.$changePassengersFxStatus,target:aa}],or:{sid:"-5uuivi"}}),(0,n.sample)({and:[{clock:ta,target:Gr.changePassengersFx}],or:{sid:"-5s3jwp"}});var sa=a(84082);const{$geoIpPlace:na}=sa.B.outputs,{changeExternalSettingFx:ia}=Ee,oa=na.map((e=>e?.cityIata??null));(0,n.sample)({and:[{source:oa,filter:Boolean,fn:e=>({key:"geoip",value:e}),target:ia}],or:{sid:"77je5c"}});const{$userSettings:ca}=ge,{updateUserSettingsFx:da}=ue,la=(0,v.kl)("citizenship"),ua=(0,n.attach)({and:{mapParams:e=>({citizenship:e.toUpperCase()}),effect:da},or:{sid:"m8o2m0"}}),ga=d.createEffect(la.read,{sid:"-cy3qro"}),ha=d.createStore(null,{sid:"gkc57x"}).on(ga.doneData,((e,r)=>r)),ma=(0,n.combine)({and:[ca,ha,g.D.outputs.$market,(e,r,a)=>e?.citizenship||r||a.toUpperCase()],or:{sid:"-h1vzvv"}});(0,n.sample)({and:[{clock:w,filter:h.y.outputs.$isClient,target:ga}],or:{sid:"-efyr8l"}});const pa={changeUserCitizenshipFx:ua},fa={$userCitizenship:ma},{createChangeSettingEffect:_a,extractSettingStore:va}=xe,Sa="contact_info",Ea=va({key:Sa,initial:{},mapper:JSON.parse}),ka={changeContactsFx:_a({key:Sa,mapper:JSON.stringify})},xa={$contacts:Ea},{createChangeSettingEffect:ya}=xe,Ua={changePreventGeoipFx:ya({key:"prevent_geoip",mapper:JSON.stringify})};var Fa=a(77349);const{$activeEmail:wa}=Sr,Pa=(0,v.Yu)("usc-user-data-report-creating"),$a=(0,n.attach)({and:{source:$,mapParams:(e,r)=>({email:e,guestia:r}),effect:(0,n.createEffect)((({email:e,guestia:r})=>{if(!r)throw new Error("Guestia method called before initialization");return r.requestUserDataReport(e)}),{sid:"-7lfkzt"})},or:{sid:"-jkz58g"}}),Ca=d.createEffect((()=>{const e=(0,Fa.Z)(new Date,2).toISOString();return Pa.write(e),e}),{sid:"9qrrj1"}),ba=d.createEffect(Pa.remove,{sid:"-hbq41w"}),Da=d.createEvent({sid:"81aado"}),za=(0,n.createStore)(Pa.read(),{sid:"-kuzt62"}).on(Ca.doneData,((e,r)=>r)).on(Be,(()=>null)).map((e=>!!e&&e>=(new Date).toISOString()));(0,n.sample)({and:[{clock:Da,source:wa,filter:e=>Boolean(e),target:$a}],or:{sid:"-u2d0zj"}}),(0,n.sample)({and:[{clock:$a.done,target:Ca}],or:{sid:"-tmysdf"}}),(0,n.sample)({and:[{source:$a.fail,filter:({error:e})=>409===e.status,target:Ca}],or:{sid:"-t84cco"}}),(0,n.sample)({and:[{clock:Be,target:ba}],or:{sid:"-t4tksi"}}),(0,n.sample)({and:[{source:za,filter:e=>!e,target:ba}],or:{sid:"-ttdip5"}});const Aa={getUserDataReport:Da,userDataReportFx:$a},La={$isUserDataReportCreating:za};var ja=a(99186);const Ga=(0,n.attach)({and:{source:{guestia:$,language:ja.l.outputs.$language},effect:({guestia:e,language:r},a)=>{if(!e)throw new Error("Guestia method createMarketingSubscriptionFx called before initialization");return e.createMarketingSubscription({language:r,...a})}},or:{sid:"a2i8pc"}}),Ia={createMarketingSubscriptionFx:Ga},qa=(0,n.attach)({and:{source:$,effect:e=>{if(!e)throw new Error("Guestia: getUserPassengersFx method called before initialization");return e.getUserPassengers()}},or:{sid:"8606xx"}}),Ba=(0,n.attach)({and:{source:$,effect:(e,r)=>{if(!e)throw new Error("Guestia: addUserPassengerFx method called before initialization");return e.addUserPassenger(r)}},or:{sid:"67g3cg"}}),Oa=(0,n.attach)({and:{source:$,effect:(e,{index:r,passenger:a})=>{if(!e)throw new Error("Guestia: getUserPassengersFx method called before initialization");return e.editUserPassenger(r,a)}},or:{sid:"-5u72ei"}}),Va=(0,n.attach)({and:{source:$,effect:(e,r)=>{if(!e)throw new Error("Guestia: removeUserPassengerFx method called before initialization");return e.removeUserPassenger(r)}},or:{sid:"-uckom9"}}),Za=(0,n.createEvent)({sid:"-olx524"}),Na=d.createStore([],{sid:"t7ttyr"}).on(Za,((e,r)=>r));b("user_passengers_changed",Za);const Ra={getUserPassengersFx:qa,addUserPassengerFx:Ba,editUserPassengerFx:Oa,removeUserPassengerFx:Va},Ha={$userPassengers:Na},{getUserPassengersFx:Ma,addUserPassengerFx:Ta,editUserPassengerFx:Ja,removeUserPassengerFx:Ya}=Ra;function Ka(e,r){return{msg:`[user service — user passengers] error during ${e} user passengers`,error:r}}const{log:Xa}=(0,I.cr)("usercom",{name:"user_passengers"});Xa({level:"error",clock:[Ma.fail.map((({error:e})=>Ka("get",e))),Ta.fail.map((({error:e})=>Ka("add",e))),Ja.fail.map((({error:e})=>Ka("edit",e))),Ya.fail.map((({error:e})=>Ka("remove",e)))]});const Qa=(0,n.createEvent)({sid:"-xqa3c8"}),Wa=(0,n.attach)({and:{source:$,effect:e=>{if(!e)throw new Error("[user service — user paid content info] Guestia method called before initialization");return e.fetchPaidContentInfo()}},or:{sid:"fj6ctb"}}),et=(0,n.withFactory)({sid:"h43eob",fn:()=>(0,qe.i)(Wa)}),rt=(0,n.createEvent)({sid:"-rrx788"}),at=d.createStore(!1,{sid:"kd5utk"}).on(Wa.doneData,((e,r)=>r?.paid_content?.has_purchases??!1));(0,n.sample)({and:[{clock:rt,target:Wa}],or:{sid:"-2vsjp2"}}),(0,n.sample)({and:[{clock:Wa.failData,fn:e=>e.message,target:Qa}],or:{sid:"-2t1kq9"}});const tt={fetchUserPaidContent:rt},st={$userPaidContentFetchStatus:et,$hasUserPurchases:at},nt={fetchUserPaidContentFailed:Qa},it=(0,I.cr)("usercom",{name:"user_paid_content"});(0,n.sample)({and:[{clock:nt.fetchUserPaidContentFailed,fn:e=>({msg:"[user service — user paid content info] error during fetch user paid content info",error:new Error(e)}),target:it.sendErrorLog}],or:{sid:"-sc1vp6"}});const ot=(0,n.attach)({and:{source:$,effect:e=>{if(!e)throw new Error("Guestia: getUserPropertiesFx method called before initialization");return e.getUserProperties()}},or:{sid:"4ywm6o"}}),ct=(0,n.createEvent)({sid:"-yd24zk"}),dt=d.createStore(null,{sid:"bz1if8"}).on(ct,((e,r)=>r)),lt=dt.map((e=>e?.orders??null)),ut=lt.map((e=>e?.order_counters??null));b("user_properties_changed",ct);const gt={getUserPropertiesFx:ot},ht={$userProperties:dt,$userOrders:lt,$userOrderCounters:ut},mt=(0,I.cr)("usercom",{name:"user_properties"});(0,n.sample)({and:[{clock:gt.getUserPropertiesFx.failData,fn:e=>({msg:"[user service — user properties] error during fetch user properties",error:new Error(e.message)}),target:mt.sendErrorLog}],or:{sid:"4v2s6"}});const pt=(0,n.createEvent)({sid:"qm71x7"}),ft={$searchId:(0,n.restore)(pt,null,{sid:"fnupn3"}),fillSearchId:pt},_t={inputs:{...pa,...ka,...Pr,...vr,...Gr,...Ua,...He,...Ee,...Aa,...yr,...ue,...Ia,...Ra,...tt,...gt,createGuestiaSubscription:b,resetUser:Be},outputs:{...fa,...xa,...Sr,...Ge,...Ir,...Me,...ke,...La,...Ur,...ge,...Xe,...Ha,...st,...ht,guestiaInited:C,$guestia:$,flags:t},internals:{...$r,...Ie,...qr,...ft,DEFAULT_FOREIGN_CARDS_FLAG_VALUE:J}},vt=(0,s.Yn)({lifecycle:{start:w},importMetaUrl:"file:///home/jenkins/agent/workspace/selene/client/src/platform/services/user/index.ts",api:_t})}}]);
//# sourceMappingURL=https://private-static.prod.k8s.int.avs.io/selene-source-maps/platform-7dc0ed19aa47b7be869e17b4e6979bc1bae2599d.27d179797da1627eefa8.min.js.map