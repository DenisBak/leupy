"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[5423],{41832:function(e,r,t){t.d(r,{y:function(){return J}}),t(21703);var n=t(30091),s=(t(26699),t(98116)),c=t(38032),a=t(54448),i=t(25893),u=t(85974),o=t(25628),d=t(83781),l=t(79403),y=t(53788),p=t(82672),h=t(20611),g=t(35529),m=t(76588),f=t(80472),v=t(63246),C=t(82525),_=t(57640),k=t(75381),E=t(78260);let b;!function(e){e.CurrencyChanged="service/helios/currency/currency_changed",e.CurrencyShouldChange="service/helios/currency/currency_should_change",e.UpdateCurrencyRates="service/helios/currency/update_currency_rates"}(b||(b={}));const{urlWithApiHost:$}=C.B.outputs,{SEARCH_ENGINE_HOST:w}=_.H,S=(0,s.createEvent)({sid:"3ekyqm"}),A=(0,d.Sy)((0,d.ZE)(b.UpdateCurrencyRates)),U=(0,s.withFactory)({sid:"ffihmw",fn:()=>(0,m.s5)({name:"currency_rates",initialData:{},request:{method:"GET",url:$(k.Nv`${w}/currency.json`,{escape:!1})},response:{contract:(0,f.v)((0,g.Dictionary)(g.Number,g.String))}})});(0,s.withFactory)({sid:"-qh3tei",fn:()=>(0,m.XD)(U,{times:3,delay:100})});const x=U.$status,D=U.$data;(0,s.sample)({and:[{clock:S,filter:v.y.outputs.$isClient,target:U.start}],or:{sid:"-q29ddr"}}),(0,s.sample)({and:[{source:D,fn:e=>({currencyRates:e}),target:A}],or:{sid:"-pnexd0"}});const q=(0,E.cr)("platform",{name:"currency_rates"});(0,s.sample)({and:[{clock:U.finished.failure,fn:e=>({label:"currency_service",msg:"Currency rates request failed after retries",extra:{explanation:e.error.explanation,errorType:e.error.errorType}}),target:q.sendWarningLog}],or:{sid:"-p6dayt"}});const O=["rub","eur","usd","cny","uah","kzt","azn","byn","thb","kgs","uzs","tzs","kes","zar","ron","mdl","inr","ils","pln","gbp","cad","tjs","gel","twd","brl","krw","aud"],{dangerouslyReadBrand:T}=l.U.outputs,{matchPage:L,pages:R}=p.$.outputs,{createQueryParameterApi:j}=h.D.inputs,z=(0,s.createEvent)({sid:"-m51rw1"}),H=(0,s.createEvent)({sid:"-bs0iov"}),N=(0,s.createEvent)({sid:"xrgrkh"}),P=(0,s.createEvent)({sid:"-inkiwz"}),F=(0,s.createEvent)({sid:"-8q3g0v"}),B=(0,s.createEvent)({sid:"-xny1py"}),G=(0,s.createEvent)({sid:"sutci"}),I=(0,s.createStore)(null,{sid:"-fqt4vt"}).on(H,((e,r)=>r));(0,s.sample)({and:[{clock:z,target:N}],or:{sid:"27ish4"}}),(0,s.split)({and:[{source:P,match:{reload:(0,s.withFactory)({sid:"4cx3fi",fn:()=>(0,c.f)((0,s.withFactory)({sid:"-rx5p4b",fn:()=>(0,a.or)(L(R.SearchPage).$isOpen,L(R.ProfileAccountPages).$isOpen)}))})},cases:{reload:B,__:G}}],or:{sid:"hybd3j"}});const Z=j({name:"currency",clientOnly:!0});(0,s.sample)({and:[{clock:B,source:I,fn:e=>({value:e??"usd",navigationType:"reload"}),target:Z.set}],or:{sid:"iwyeha"}}),(0,s.sample)({and:[{clock:G,source:I,fn:e=>({value:e??"usd",navigationType:"replace"}),target:Z.set}],or:{sid:"je00vh"}}),(0,s.sample)({and:[{clock:F,target:N}],or:{sid:"jv1n9o"}});const K=(0,s.combine)({and:[{brand:l.U.outputs.$brand,market:y.D.outputs.$market},({brand:e,market:r})=>(i[e][r]??[]).map((e=>u[e]))],or:{sid:"s4n6vl"}}),W=(0,o.IG)("usd",(()=>"AS"===T()?"rub":"usd")),M=(0,s.createStore)(W,{sid:"-wp0c52"}),Q=M.map((e=>e.toUpperCase()));(0,s.sample)({and:[{clock:[I,K],source:{userCurrency:I,currency:M,currencies:K},filter:({currency:e,userCurrency:r})=>e!==r,fn:function({userCurrency:e,currency:r,currencies:t}){return t&&e&&t.map((({value:e})=>e)).includes(e)&&O.includes(e)?e:r},target:M}],or:{sid:"lsbq16"}});const V=(0,d.V6)((0,d.ZE)(b.CurrencyShouldChange)),X=(0,d.Sy)((0,d.ZE)(b.CurrencyChanged));(0,s.sample)({and:[{clock:[M,S],source:M,target:X}],or:{sid:"y0qxbf"}}),(0,s.sample)({and:[{clock:V,target:z}],or:{sid:"y41ovl"}});const Y={outputs:{$currencies:K,$currency:M,$currencyUpperCase:Q,$currencyRates:D,$fetchCurrencyRatesFxStatus:x},inputs:{changeCurrency:z},internals:{$userCurrency:I,changeUserCurrency:N,fillUserCurrency:H,userCurrencyUpdated:P}},J=(0,n.Yn)({lifecycle:{start:S},importMetaUrl:"file:///home/jenkins/agent/workspace/selene/client/src/platform/services/currency/index.ts",attachTestApi(){throw new Error("Test API is not available in production")},api:Y})}}]);
//# sourceMappingURL=https://private-static.prod.k8s.int.avs.io/selene-source-maps/platform-9d67ce5066fc8140a9666bf6cb3de386140be277.67c2bca20229c516dcef.min.js.map